	AREA IM, CODE, READONLY
	ENTRY

MAIN
	; RETRIEVE THE ADDRESS FOR EVERY VARIABLE
	LDR R0, =stack_top;
	LDR R4, =N;
	LDR R5, =Y;

	# SET ADDRESS OF STACK TO THE STACK POINTER
	MOV SP, R0;

	; SET R0 TO SIX AND SAVE THE VALUE ON N
	MOV R0, #6;
	STR R0, [R4];

	; START THE FACTORIAL FUNCTION
	; THE FACTORIAL FUNCTION EXPECTS THE NUMBER AT R0
	; AND ALSO RETURNS THE RESULT AT R0
	BL FACTORIAL;
	
	; STORE THE RESULT ON Y
	STR R0, [R5];
	
HERE B HERE;
	
; FACTORIAL SUBROUTINE. USES R0 AND R1
FACTORIAL
	PUSH {R0, LR};
	CMP R0, #1;
	BGT ELSE;
	MOV R0, #1;
	ADD SP, SP, #8;
	BX LR;

ELSE
	SUB R0, R0, #1;
	BL FACTORIAL
	POP {R1, LR};
	MUL R0, R1, R0;
	BX LR;

; AREA FOR THE VARIABLES
	AREA DM, DATA, READWRITE
N	space 50*4;
Y	space 50*4;
	
; AREA FOR THE STACK
	AREA STACK, DATA, READWRITE, NOINIT, ALIGN=3
stack_limit
	SPACE 100*4
stack_top

	END;
